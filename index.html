<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InCanva - AIè®¾è®¡åŠ©æ‰‹</title>
    <!-- FontAwesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #e5e5e5;
            height: 100vh;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            width: 100%;
            height: 100vh;
            position: relative;
        }

        /* CanvasåŒºåŸŸ */
        .canvas-container {
            width: 100%;
            height: 100%;
            background: #e5e5e5;
            position: relative;
        }

        /* Excelè¡¨æ ¼å®¹å™¨ */
        .excel-container {
            position: absolute;
            left: 40px;
            top: 80px;
            width: 32%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-height: 70vh;
            overflow: hidden; /* éšè—æ»šåŠ¨æ¡ */
            /* éšè—æ»šåŠ¨æ¡çš„è·¨æµè§ˆå™¨æ”¯æŒ */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
            z-index: 10; /* Excelå®¹å™¨å±‚çº§æœ€ä½ */
        }

        /* éšè—Excelå®¹å™¨æ»šåŠ¨æ¡ */
        .excel-container::-webkit-scrollbar {
            width: 0px;
            background: transparent;
            display: none; /* Chrome, Safari, Opera */
        }

        .excel-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .excel-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .excel-table th {
            background: #f8f9fa;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        .excel-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #e9ecef;
            color: #495057;
        }

        .excel-table tr:hover {
            background: #f8f9fa;
        }

        .search-query {
            font-weight: 500;
        }

        .search-frequency {
            text-align: right;
            font-weight: 600;
            color: #0066cc;
        }

        /* Excelè¡¨æ ¼å®¹å™¨ */
        .excel-container {
            position: absolute;
            left: 40px;
            top: 440px;
            width: 32%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
            cursor: move;
            user-select: none;
            z-index: 10; /* Excelå®¹å™¨å±‚çº§æœ€ä½ */
        }

        .excel-container:hover {
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
        }

        /* Wordæ–‡æ¡£å®¹å™¨ */
        .word-container {
            position: absolute;
            left: 34%;
            top: 80px;
            width: 32%;
            height: 60vh;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: none;
            max-height: 60vh;
            overflow: hidden;
            font-family: 'Calibri', 'Times New Roman', serif;
            padding: 20px;
            cursor: move;
            user-select: none;
            z-index: 20; /* Wordå®¹å™¨å±‚çº§ä¸­ç­‰ */
        }

        .word-container:hover {
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
        }

        /* æ‹–æ‹½æ—¶çš„æ ·å¼ */
        .dragging {
            z-index: 1000; /* æ‹–æ‹½æ—¶æœ€é«˜å±‚çº§ */
            transform: rotate(2deg);
            opacity: 0.9;
        }

        /* é€‰ä¸­çŠ¶æ€çš„æ ·å¼ */
        .selected {
            border: 3px solid #007bff;
            box-shadow: 0 6px 30px rgba(0, 123, 255, 0.3);
        }

        /* è°ƒæ•´å¤§å°åŠŸèƒ½æ ·å¼ */
        .resizable {
            resize: both;
            overflow: auto;
            min-width: 200px;
            min-height: 150px;
        }

        /* è°ƒæ•´å¤§å°æ‰‹æŸ„æ ·å¼ */
        .resize-handle {
            position: absolute;
            background: transparent; /* å®Œå…¨é€æ˜èƒŒæ™¯ */
            opacity: 0; /* å®Œå…¨é€æ˜ */
            transition: none; /* ç§»é™¤è¿‡æ¸¡æ•ˆæœ */
        }

        .resize-handle:hover {
            opacity: 0; /* æ‚¬åœæ—¶ä¹Ÿä¿æŒé€æ˜ */
            background: transparent; /* ç¡®ä¿èƒŒæ™¯é€æ˜ */
        }

        .selected .resize-handle {
            opacity: 0; /* é€‰ä¸­æ—¶ä¹Ÿä¿æŒé€æ˜ */
            background: transparent; /* ç¡®ä¿èƒŒæ™¯é€æ˜ */
        }

        .selected .resize-handle:hover {
            opacity: 0; /* é€‰ä¸­ä¸”æ‚¬åœæ—¶ä¹Ÿä¿æŒé€æ˜ */
            background: transparent; /* ç¡®ä¿èƒŒæ™¯é€æ˜ */
        }

        /* è°ƒæ•´å¤§å°æ—¶éšè—æ‰‹æŸ„ */
        .resizing .resize-handle {
            opacity: 0 !important;
            background: transparent !important;
        }

        /* è°ƒæ•´å¤§å°æ—¶éšè—é€‰ä¸­è¾¹æ¡† */
        .resizing.selected {
            border: none !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1) !important;
        }

        /* å³ä¸‹è§’è°ƒæ•´å¤§å°æ‰‹æŸ„ */
        .resize-handle-se {
            width: 15px;
            height: 15px;
            bottom: 0;
            right: 0;
            cursor: se-resize;
        }

        /* å³è¾¹è°ƒæ•´å¤§å°æ‰‹æŸ„ */
        .resize-handle-e {
            width: 5px;
            height: 100%;
            top: 0;
            right: 0;
            cursor: e-resize;
        }

        /* åº•éƒ¨è°ƒæ•´å¤§å°æ‰‹æŸ„ */
        .resize-handle-s {
            width: 100%;
            height: 5px;
            bottom: 0;
            left: 0;
            cursor: s-resize;
        }

        /* æ–‡æ¡£å¤é€‰æ¡†æ ·å¼ */
        .document-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        /* Excelå¤é€‰æ¡†å±‚çº§ */
        .excel-container .document-checkbox {
            z-index: 15; /* Excelå¤é€‰æ¡† */
        }

        /* Wordå¤é€‰æ¡†å±‚çº§ */
        .word-container .document-checkbox {
            z-index: 25; /* Wordå¤é€‰æ¡† */
        }

        /* Claudeå¤é€‰æ¡†å±‚çº§ */
        .claude-output-container .document-checkbox {
            z-index: 35; /* Claudeå¤é€‰æ¡†ï¼Œæœ€é«˜å±‚çº§ */
        }

        .checkbox-input {
            display: none;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .checkbox-label:hover {
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
        }

        .checkbox-label i {
            font-size: 12px;
            color: transparent;
            transition: color 0.2s ease;
        }

        .checkbox-input:checked + .checkbox-label {
            background: #007bff;
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }

        .checkbox-input:checked + .checkbox-label i {
            color: white;
        }

        /* Excelå·¥å…·æ æ ·å¼ */
        .excel-toolbar {
            background: #f8f9fa; /* ä¸Wordç›¸åŒçš„ç°è‰²èƒŒæ™¯ */
            border-bottom: 1px solid #e5e7eb; /* ä¸Wordç›¸åŒçš„è¾¹æ¡†è‰² */
            padding: 8px 50px 8px 15px; /* ä¸ºå¤é€‰æ¡†ç•™ç©ºé—´ */
            font-size: 11px;
            color: #6b7280; /* ä¸Wordç›¸åŒçš„æ–‡å­—é¢œè‰² */
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: -20px -20px 0 -20px;
        }

        .excel-filename {
            font-weight: 500;
            color: #374151; /* ä¸Wordç›¸åŒçš„æ–‡ä»¶åé¢œè‰² */
        }

        .excel-filename i {
            color: #217346; /* Excelç»¿è‰²å›¾æ ‡ */
            margin-right: 6px;
        }

        .excel-content {
            padding: 20px;
            height: calc(100% - 70px); /* åŠ¨æ€é«˜åº¦ï¼Œå‡å»å·¥å…·æ é«˜åº¦ */
            overflow-y: auto;
            background: white;
            margin: 0;
            box-shadow: none;
            /* éšè—æ»šåŠ¨æ¡ä½†ä¿æŒæ»šåŠ¨åŠŸèƒ½ */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }

        /* éšè—Excelå†…å®¹æ»šåŠ¨æ¡ä½†ä¿æŒæ»šåŠ¨åŠŸèƒ½ */
        .excel-content::-webkit-scrollbar {
            width: 0px;
            background: transparent;
            display: none; /* Chrome, Safari, Opera */
        }

        .word-toolbar {
            background: #f8f9fa;
            border-bottom: 1px solid #e5e7eb;
            padding: 8px 50px 8px 15px; /* å¢åŠ å³ä¾§paddingä¸ºå¤é€‰æ¡†ç•™ç©ºé—´ */
            font-size: 11px;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: -20px -20px 0 -20px;
        }

        .word-filename {
            font-weight: 500;
            color: #374151;
        }

        .word-filename i {
            color: #2b579a; /* Wordè“è‰²å›¾æ ‡ */
            margin-right: 6px;
        }

        .word-document {
            padding: 20px;
            height: calc(100% - 50px); /* åŠ¨æ€é«˜åº¦ï¼Œå‡å»å·¥å…·æ é«˜åº¦ */
            overflow-y: auto;
            background: white;
            margin: 0;
            box-shadow: none;
        }

        /* éšè—Wordæ–‡æ¡£æ»šåŠ¨æ¡ä½†ä¿æŒæ»šåŠ¨åŠŸèƒ½ */
        .word-document::-webkit-scrollbar {
            width: 0;
            background: transparent;
        }

        .word-document {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }

        .word-header {
            border-bottom: none;
            padding-bottom: 20px;
            margin-bottom: 25px;
            text-align: center;
        }

        .word-title {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
            font-family: 'Calibri', sans-serif;
        }

        .word-subtitle {
            font-size: 14px;
            color: #6b7280;
            font-weight: 400;
            font-style: italic;
        }

        .word-content {
            line-height: 1.8;
            color: #1f2937;
            font-size: 14px;
            font-family: 'Calibri', sans-serif;
        }

        .word-section {
            margin-bottom: 25px;
        }

        .word-section h3 {
            font-size: 16px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 12px;
            border-left: none;
            padding-left: 0;
            font-family: 'Calibri', sans-serif;
        }

        .word-section p {
            font-size: 14px;
            margin-bottom: 12px;
            text-align: justify;
            text-indent: 0;
            line-height: 1.8;
        }

        .word-list {
            font-size: 14px;
            margin-left: 20px;
            margin-bottom: 15px;
            line-height: 1.8;
        }

        .word-list li {
            margin-bottom: 8px;
        }

        .highlight {
            background: #fef3c7;
            padding: 1px 3px;
            border-radius: 2px;
        }

        /* Wordæ–‡æ¡£é¡µè¾¹è·å’Œé¡µé¢æ ·å¼ */
        .word-document::before {
            content: '';
            position: absolute;
            top: 0;
            left: 20px;
            right: 20px;
            height: 1px;
            background: #e5e7eb;
        }

        /* åŠ¨ç”»æ•ˆæœ */

        .canvas-area {
            width: 100%;
            height: 100%;
            background: transparent;
            position: relative;
        }

        .canvas-placeholder {
            display: none;
        }

        .canvas-icon {
            width: 80px;
            height: 80px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            font-size: 32px;
        }

        /* Claudeè¾“å‡ºå®¹å™¨æ ·å¼ */
        .claude-output-container {
            position: absolute;
            left: 50%;
            top: 80px;
            width: 48%;
            height: 60vh;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: none;
            max-height: 60vh;
            overflow: hidden;
            font-family: 'Calibri', 'Times New Roman', serif;
            padding: 10px;
            cursor: move;
            user-select: none;
            display: none; /* é»˜è®¤éšè— */
            z-index: 30; /* Claudeå®¹å™¨å±‚çº§æœ€é«˜ */
        }

        .claude-output-container:hover {
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
        }

        .claude-output-toolbar {
            background: #f8f9fa;
            border-bottom: 1px solid #e5e7eb;
            padding: 8px 50px 8px 15px;
            font-size: 11px;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: -10px -10px 0 -10px;
        }

        .claude-output-filename {
            font-weight: 500;
            color: #374151;
        }

        .claude-output-filename i {
            color: #667eea; /* Claudeç´«è‰²å›¾æ ‡ */
            margin-right: 6px;
        }

        .claude-output-content {
            padding: 5px;
            height: calc(100% - 50px);
            overflow-y: auto;
            background: white;
            margin: 0;
            box-shadow: none;
            /* éšè—æ»šåŠ¨æ¡ä½†ä¿æŒæ»šåŠ¨åŠŸèƒ½ */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }

        .claude-output-content::-webkit-scrollbar {
            width: 0;
            background: transparent;
        }

        /* æ‚¬æµ®å¯¹è¯æ¡† */
        .chat-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 1000;
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        .chat-header {
            background: white;
            color: #333;
            padding: 0;
            display: none;
        }

        .chat-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .chat-status {
            font-size: 12px;
            opacity: 0.8;
        }

        .chat-messages {
            height: 200px;
            padding: 16px;
            overflow-y: auto;
            background: white;
            transition: height 0.3s ease, opacity 0.3s ease;
        }

        /* å½“æ²¡æœ‰æ¶ˆæ¯æ—¶éšè—å¯¹è¯å†å²åŒºåŸŸ */
        .chat-messages.empty {
            height: 0;
            padding: 0;
            opacity: 0;
            overflow: hidden;
        }

        .message {
            margin-bottom: 16px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            margin: 0 10px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: #667eea;
            color: white;
        }

        .message.ai .message-avatar {
            background: #e8ecf3;
            color: #667eea;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-weight: 400;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 6px;
        }

        .message.ai .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* è¾“å…¥æ¡†åŒºåŸŸ */
        .chat-input-container {
            padding: 16px;
            background: white;
            border-top: 1px solid #e5e5e5;
        }

        .chat-input-wrapper {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 25px;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .chat-input-wrapper:focus-within {
            border-color: #007bff;
            box-shadow: 0 2px 12px rgba(0, 123, 255, 0.15);
        }

        .chat-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 0;
            font-size: 15px;
            outline: none;
            resize: none;
            min-height: 22px;
            max-height: 100px;
            line-height: 1.4;
            color: #333;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-weight: 400;
        }

        .chat-input::placeholder {
            color: #999;
        }

        .send-button {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #f0f0f0;
            color: #666;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
            margin-left: 8px;
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #bbb;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .chat-container {
                bottom: 20px;
                left: 20px;
                right: 20px;
                width: auto;
                transform: none;
            }
        }

        /* æ¶ˆæ¯åŠ¨ç”»æ•ˆæœ */

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- CanvasåŒºåŸŸ -->
        <div class="canvas-container">
            <div class="canvas-area">
                <div class="canvas-placeholder">
                    <div class="canvas-icon">ğŸ¨</div>
                    <p>æ‚¨çš„åˆ›ä½œç”»å¸ƒ</p>
                    <p style="font-size: 14px; margin-top: 8px; opacity: 0.7;">å¼€å§‹ä¸AIå¯¹è¯æ¥åˆ›å»ºè®¾è®¡</p>
                </div>
            </div>

            <!-- Excelè¡¨æ ¼ -->
            <div class="excel-container">
                <div class="document-checkbox" data-document="excel">
                    <input type="checkbox" id="excel-checkbox" class="checkbox-input">
                    <label for="excel-checkbox" class="checkbox-label">
                        <i class="fas fa-check"></i>
                    </label>
                </div>
                <!-- è°ƒæ•´å¤§å°æ‰‹æŸ„ -->
                <div class="resize-handle resize-handle-se"></div>
                <div class="resize-handle resize-handle-e"></div>
                <div class="resize-handle resize-handle-s"></div>
                <div class="excel-toolbar">
                    <div class="excel-filename"><i class="fas fa-file-excel"></i> PPT_Template_Search_Data.xlsx</div>
                    <div>Microsoft Excel</div>
                </div>
                <div class="excel-content">
                    <div class="excel-title">PPT Template Search Data</div>
                    <table class="excel-table">
                    <thead>
                        <tr>
                            <th>Search Query</th>
                            <th>Frequency</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="search-query">business presentation template</td>
                            <td class="search-frequency">2,847</td>
                        </tr>
                        <tr>
                            <td class="search-query">corporate slides design</td>
                            <td class="search-frequency">2,156</td>
                        </tr>
                        <tr>
                            <td class="search-query">marketing pitch deck</td>
                            <td class="search-frequency">1,923</td>
                        </tr>
                        <tr>
                            <td class="search-query">modern powerpoint template</td>
                            <td class="search-frequency">1,784</td>
                        </tr>
                        <tr>
                            <td class="search-query">startup pitch presentation</td>
                            <td class="search-frequency">1,567</td>
                        </tr>
                        <tr>
                            <td class="search-query">financial report template</td>
                            <td class="search-frequency">1,432</td>
                        </tr>
                        <tr>
                            <td class="search-query">project proposal slides</td>
                            <td class="search-frequency">1,298</td>
                        </tr>
                        <tr>
                            <td class="search-query">creative presentation design</td>
                            <td class="search-frequency">1,189</td>
                        </tr>
                        <tr>
                            <td class="search-query">annual report template</td>
                            <td class="search-frequency">1,067</td>
                        </tr>
                        <tr>
                            <td class="search-query">sales presentation template</td>
                            <td class="search-frequency">945</td>
                        </tr>
                        <tr>
                            <td class="search-query">educational slides template</td>
                            <td class="search-frequency">876</td>
                        </tr>
                        <tr>
                            <td class="search-query">conference presentation</td>
                            <td class="search-frequency">798</td>
                        </tr>
                        <tr>
                            <td class="search-query">timeline presentation template</td>
                            <td class="search-frequency">723</td>
                        </tr>
                        <tr>
                            <td class="search-query">data visualization slides</td>
                            <td class="search-frequency">654</td>
                        </tr>
                        <tr>
                            <td class="search-query">team presentation template</td>
                            <td class="search-frequency">587</td>
                        </tr>
                        <tr>
                            <td class="search-query">product launch presentation</td>
                            <td class="search-frequency">512</td>
                        </tr>
                        <tr>
                            <td class="search-query">strategy presentation template</td>
                            <td class="search-frequency">445</td>
                        </tr>
                        <tr>
                            <td class="search-query">training presentation slides</td>
                            <td class="search-frequency">378</td>
                        </tr>
                        <tr>
                            <td class="search-query">investor pitch template</td>
                            <td class="search-frequency">321</td>
                        </tr>
                        <tr>
                            <td class="search-query">minimal presentation design</td>
                            <td class="search-frequency">267</td>
                        </tr>
                    </tbody>
                </table>
                </div>
            </div>

            <!-- Wordæ–‡æ¡£ -->
            <div class="word-container">
                <div class="document-checkbox" data-document="word">
                    <input type="checkbox" id="word-checkbox" class="checkbox-input">
                    <label for="word-checkbox" class="checkbox-label">
                        <i class="fas fa-check"></i>
                    </label>
                </div>
                <!-- è°ƒæ•´å¤§å°æ‰‹æŸ„ -->
                <div class="resize-handle resize-handle-se"></div>
                <div class="resize-handle resize-handle-e"></div>
                <div class="resize-handle resize-handle-s"></div>
                <div class="word-toolbar">
                    <div class="word-filename"><i class="fas fa-file-word"></i> PPT_Template_User_Research_Report.docx</div>
                    <div>Microsoft Word</div>
                </div>
                
                <div class="word-document">
                    <div class="word-header">
                        <div class="word-title">PPT Template User Research Report</div>
                        <div class="word-subtitle">Market Analysis & User Behavior Study | December 2024</div>
                    </div>

                    <div class="word-content">
                        <div class="word-section">
                            <h3>Executive Summary</h3>
                            <p>This comprehensive user research report analyzes the current market trends and user preferences for PowerPoint templates. Based on extensive data collection from over <span class="highlight">50,000 users</span> across different industries, we identify key patterns in template usage and design preferences.</p>
                        </div>

                        <div class="word-section">
                            <h3>Key Findings</h3>
                            <ul class="word-list">
                                <li><strong>Business Templates:</strong> Account for 68% of all searches</li>
                                <li><strong>Visual Design:</strong> Modern, clean layouts preferred by 84% of users</li>
                                <li><strong>Color Schemes:</strong> Professional blue/grey combinations dominate</li>
                                <li><strong>Industry Focus:</strong> Corporate and startup presentations lead demand</li>
                            </ul>
                        </div>

                        <div class="word-section">
                            <h3>User Demographics</h3>
                            <p>Primary users consist of business professionals (45%), educators (23%), consultants (18%), and entrepreneurs (14%). The majority of users are aged between 25-45 years and work in corporate environments requiring regular presentation creation.</p>
                        </div>

                        <div class="word-section">
                            <h3>Design Preferences</h3>
                            <p>Users consistently favor templates with <span class="highlight">minimalist designs</span>, clear typography, and structured layouts. Data visualization capabilities and infographic elements are increasingly important, with 72% of users seeking templates that support chart integration.</p>
                        </div>

                        <div class="word-section">
                            <h3>Market Opportunities</h3>
                            <ul class="word-list">
                                <li>Industry-specific template collections</li>
                                <li>Interactive presentation elements</li>
                                <li>AI-powered design suggestions</li>
                                <li>Collaborative editing features</li>
                            </ul>
                        </div>

                        <div class="word-section">
                            <h3>Recommendations</h3>
                            <p>Based on our research, we recommend focusing on creating versatile business templates with customizable color schemes and enhanced data visualization tools. Priority should be given to developing templates for emerging sectors like technology startups and sustainable business presentations.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Claudeä»»åŠ¡è¾“å‡ºå®¹å™¨ -->
            <div class="claude-output-container" id="claudeOutputContainer">
                <div class="document-checkbox" data-document="claude">
                    <input type="checkbox" id="claude-checkbox" class="checkbox-input">
                    <label for="claude-checkbox" class="checkbox-label">
                        <i class="fas fa-check"></i>
                    </label>
                </div>
                <!-- è°ƒæ•´å¤§å°æ‰‹æŸ„ -->
                <div class="resize-handle resize-handle-se"></div>
                <div class="resize-handle resize-handle-e"></div>
                <div class="resize-handle resize-handle-s"></div>
                <div class="claude-output-toolbar">
                    <div class="claude-output-filename">
                        <i class="fas fa-robot"></i> 
                        <span id="claudeTaskTitle">Claude Task Output</span>
                    </div>
                    <div>Claude Sonnet 4</div>
                </div>
                
                <div class="claude-output-content" id="claudeOutputContent">
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <i class="fas fa-robot" style="font-size: 32px; margin-bottom: 15px; color: #667eea;"></i>
                        <p>Claude will display task results here</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ‚¬æµ®å¯¹è¯æ¡† -->
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <!-- æ¶ˆæ¯å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </div>

            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea 
                        class="chat-input" 
                        id="chatInput" 
                        placeholder="Ask Clippy Anything"
                        rows="1"></textarea>
                    <button class="send-button" id="sendButton">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åŸºç¡€JavaScriptåŠŸèƒ½
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        
        // å­˜å‚¨å¯¹è¯å†å²
        let conversationHistory = [];
        // ç¯å¢ƒè‡ªé€‚åº”çš„APIåŸºç¡€URL
        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
            ? 'http://localhost:5000' 
            : window.location.origin;

        // åˆå§‹åŒ–ï¼šéšè—å¯¹è¯å†å²åŒºåŸŸ
        chatMessages.classList.add('empty');

        // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
        chatInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 100) + 'px';
        });

        // å›è½¦å‘é€æ¶ˆæ¯
        chatInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // å‘é€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        sendButton.addEventListener('click', sendMessage);

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            // ç¦ç”¨å‘é€æŒ‰é’®
            sendButton.disabled = true;
            sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°èŠå¤©ç•Œé¢
            addMessage(message, 'user');
            
            // æ·»åŠ åˆ°å¯¹è¯å†å²
            conversationHistory.push({
                role: 'user',
                content: message
            });
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            chatInput.value = '';
            chatInput.style.height = 'auto';

            // åˆ›å»ºAIæ¶ˆæ¯å®¹å™¨ï¼ˆç”¨äºæµå¼æ›´æ–°ï¼‰
            const aiMessageDiv = createAIMessageContainer();
            let fullResponse = '';

            try {
                let finalMessage = message;
                
                // è·å–é€‰ä¸­çš„æ–‡æ¡£å†…å®¹
                const selectedDocs = getSelectedDocumentsContent();
                
                // å¦‚æœæœ‰é€‰ä¸­çš„æ–‡æ¡£ï¼Œå°†å®ƒä»¬ä½œä¸ºé™„ä»¶æ·»åŠ åˆ°æ¶ˆæ¯ä¸­
                if (selectedDocs.length > 0) {
                    finalMessage += "\n\n--- é™„ä»¶æ–‡æ¡£ ---\n";
                    selectedDocs.forEach((doc, index) => {
                        finalMessage += `\né™„ä»¶ ${index + 1}: ${doc.title} (${doc.type})\n`;
                        finalMessage += "å†…å®¹:\n" + doc.content + "\n";
                        finalMessage += "-".repeat(50) + "\n";
                    });
                    finalMessage += "\nè¯·åŸºäºä»¥ä¸Šé™„ä»¶å†…å®¹æ¥å›ç­”æˆ‘çš„é—®é¢˜ã€‚";
                }
                
                // å¦‚æœç”¨æˆ·è¯·æ±‚åˆ›å»ºæ–‡æ¡£ï¼Œæ·»åŠ HTMLæ ¼å¼è¦æ±‚
                if (isDocumentCreationRequest(message)) {
                    finalMessage += "\n\nPlease create this as a complete HTML document with proper styling using CSS. Include all necessary HTML structure (<!DOCTYPE html>, <html>, <head>, <body>, etc.)";
                }
                
                // è°ƒç”¨åç«¯API (æµå¼)
                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: finalMessage,
                        history: conversationHistory.slice(0, -1) // ä¸åŒ…å«å½“å‰æ¶ˆæ¯
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // å¤„ç†æµå¼å“åº”
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const jsonStr = line.slice(6);
                            if (jsonStr.trim() === '') continue;

                            try {
                                const data = JSON.parse(jsonStr);
                                
                                if (data.error) {
                                    throw new Error(data.error);
                                }
                                
                                if (data.content) {
                                    fullResponse += data.content;
                                    updateAIMessage(aiMessageDiv, fullResponse);
                                }
                                
                                if (data.done) {
                                    // æµå¼å“åº”å®Œæˆ
                                    break;
                                }
                            } catch (parseError) {
                                if (jsonStr.trim() !== '') {
                                    console.warn('Failed to parse JSON:', jsonStr);
                                }
                            }
                        }
                    }
                }

                // æ·»åŠ å®Œæ•´å›å¤åˆ°å¯¹è¯å†å²ï¼ˆä½¿ç”¨åŸå§‹æ¶ˆæ¯ï¼Œä¸æ˜¯ä¿®æ”¹åçš„ï¼‰
                conversationHistory.push({
                    role: 'assistant',
                    content: fullResponse
                });

                // å¦‚æœå›å¤åŒ…å«ä»£ç æˆ–HTMLï¼Œæˆ–è€…æ˜¯æ–‡æ¡£åˆ›å»ºè¯·æ±‚ï¼Œæ˜¾ç¤ºåœ¨Claudeè¾“å‡ºå®¹å™¨ä¸­
                if (isWebContent(fullResponse) || isDocumentCreationRequest(message)) {
                    showClaudeOutput(fullResponse, isDocumentCreationRequest(message));
                }
                
            } catch (error) {
                console.error('Error calling Claude API:', error);
                
                // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                let errorMessage = 'æŠ±æ­‰ï¼Œè¿æ¥AIæœåŠ¡æ—¶å‡ºç°é—®é¢˜ã€‚';
                if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'æ— æ³•è¿æ¥åˆ°AIæœåŠ¡ã€‚è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ (python server.py)ã€‚';
                } else if (error.message.includes('HTTP error')) {
                    errorMessage = 'AIæœåŠ¡å“åº”é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚';
                } else {
                    errorMessage = `é”™è¯¯: ${error.message}`;
                }
                
                // å¦‚æœå·²ç»åˆ›å»ºäº†AIæ¶ˆæ¯å®¹å™¨ï¼Œæ›´æ–°å®ƒæ˜¾ç¤ºé”™è¯¯
                if (aiMessageDiv) {
                    updateAIMessage(aiMessageDiv, errorMessage);
                } else {
                    addMessage(errorMessage, 'ai');
                }
            } finally {
                // é‡æ–°å¯ç”¨å‘é€æŒ‰é’®
                sendButton.disabled = false;
                sendButton.innerHTML = '<i class="fas fa-paper-plane"></i>';
            }
        }

        function createAIMessageContainer() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'AI';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.textContent = '';
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return messageContent;
        }

        function updateAIMessage(messageElement, content) {
            messageElement.textContent = content;
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addMessage(content, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = type === 'user' ? 'U' : 'AI';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.textContent = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // æ˜¾ç¤ºå¯¹è¯å†å²åŒºåŸŸï¼ˆç§»é™¤emptyç±»ï¼‰
            chatMessages.classList.remove('empty');

            // åªæœ‰å½“AIå›å¤åŒ…å«HTML/ç½‘é¡µå†…å®¹æ—¶æ‰æ˜¾ç¤ºClaudeå®¹å™¨
            if (type === 'ai' && isWebContent(content)) {
                showClaudeOutput(content);
            } else if (type === 'ai') {
                // å¦‚æœAIå›å¤ä¸æ˜¯ç½‘é¡µå†…å®¹ï¼Œéšè—Claudeå®¹å™¨
                hideClaudeOutput();
            }
        }

        // è·å–é€‰ä¸­æ–‡æ¡£çš„å†…å®¹
        function getSelectedDocumentsContent() {
            const selectedDocs = [];
            
            // æ£€æŸ¥Excelå®¹å™¨æ˜¯å¦è¢«é€‰ä¸­
            const excelContainer = document.querySelector('.excel-container');
            if (excelContainer && excelContainer.classList.contains('selected')) {
                const excelContent = extractExcelContent();
                if (excelContent) {
                    selectedDocs.push({
                        type: 'excel',
                        title: 'PPT Template Search Data',
                        content: excelContent
                    });
                }
            }
            
            // æ£€æŸ¥Wordå®¹å™¨æ˜¯å¦è¢«é€‰ä¸­
            const wordContainer = document.querySelector('.word-container');
            if (wordContainer && wordContainer.classList.contains('selected')) {
                const wordContent = extractWordContent();
                if (wordContent) {
                    selectedDocs.push({
                        type: 'word',
                        title: 'PPT Template User Research Report',
                        content: wordContent
                    });
                }
            }
            
            // æ£€æŸ¥Claudeå®¹å™¨æ˜¯å¦è¢«é€‰ä¸­
            const claudeContainer = document.getElementById('claudeOutputContainer');
            if (claudeContainer && claudeContainer.classList.contains('selected')) {
                const claudeContent = extractClaudeContent();
                if (claudeContent) {
                    selectedDocs.push({
                        type: 'claude_output',
                        title: 'Claude Task Output',
                        content: claudeContent
                    });
                }
            }
            
            return selectedDocs;
        }

        // æå–Excelå†…å®¹
        function extractExcelContent() {
            const table = document.querySelector('.excel-table');
            if (!table) return null;
            
            let content = "PPT Template Search Data:\n\n";
            const rows = table.querySelectorAll('tr');
            
            rows.forEach((row, index) => {
                const cells = row.querySelectorAll('th, td');
                const rowData = Array.from(cells).map(cell => cell.textContent.trim());
                
                if (index === 0) {
                    content += rowData.join(' | ') + '\n';
                    content += '-'.repeat(50) + '\n';
                } else {
                    content += rowData.join(' | ') + '\n';
                }
            });
            
            return content;
        }

        // æå–Wordå†…å®¹
        function extractWordContent() {
            const wordDocument = document.querySelector('.word-document');
            if (!wordDocument) return null;
            
            let content = "PPT Template User Research Report\n";
            content += "Market Analysis & User Behavior Study | December 2024\n\n";
            
            const sections = wordDocument.querySelectorAll('.word-section');
            sections.forEach(section => {
                const heading = section.querySelector('h3');
                if (heading) {
                    content += heading.textContent + '\n';
                    content += '='.repeat(heading.textContent.length) + '\n';
                }
                
                const paragraphs = section.querySelectorAll('p');
                paragraphs.forEach(p => {
                    content += p.textContent + '\n\n';
                });
                
                const lists = section.querySelectorAll('ul, ol');
                lists.forEach(list => {
                    const items = list.querySelectorAll('li');
                    items.forEach(item => {
                        content += 'â€¢ ' + item.textContent + '\n';
                    });
                    content += '\n';
                });
            });
            
            return content;
        }

        // æå–Claudeè¾“å‡ºå†…å®¹
        function extractClaudeContent() {
            const claudeContent = document.getElementById('claudeOutputContent');
            if (!claudeContent) return null;
            
            const iframe = claudeContent.querySelector('iframe');
            if (iframe) {
                try {
                    // å°è¯•è·å–iframeå†…å®¹
                    return iframe.srcdoc || 'Claude generated HTML content (iframe)';
                } catch (e) {
                    return 'Claude generated content (unable to extract due to security restrictions)';
                }
            }
            
            return claudeContent.textContent.trim() || null;
        }

        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¦æ±‚åˆ›å»ºæ–‡æ¡£
        function isDocumentCreationRequest(message) {
            const messageLower = message.toLowerCase();
            
            // ä¾‹å¤–æƒ…å†µï¼šå¦‚æœæ˜¯å­¦ä¹ æ¨¡æ¿çš„è¯·æ±‚ï¼Œä¸è§¦å‘æ–‡æ¡£åˆ›å»ºæ¨¡å¼
            if (messageLower.includes('learn this as template') || 
                messageLower.includes('learn this template') ||
                messageLower.includes('study this template')) {
                return false;
            }
            
            const documentKeywords = [
                'slide', 'slides', 'presentation', 'ppt', 'powerpoint',
                'word', 'document', 'doc', 'docx', 
                'excel', 'spreadsheet', 'table', 'xlsx',
                'create', 'make', 'generate', 'build', 'design'
            ];
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«åˆ›å»ºæ–‡æ¡£çš„å…³é”®è¯ç»„åˆ
            const hasDocumentKeyword = documentKeywords.some(keyword => 
                messageLower.includes(keyword));
            
            const hasCreationKeyword = ['create', 'make', 'generate', 'build', 'design'].some(keyword =>
                messageLower.includes(keyword));
            
            return hasDocumentKeyword && (hasCreationKeyword || 
                messageLower.includes('create') || 
                messageLower.includes('make') ||
                messageLower.includes('generate') ||
                messageLower.includes('build') ||
                messageLower.includes('design'));
        }

        function isWebContent(content) {
            // æ£€æŸ¥æ˜¯å¦åŒ…å«HTMLä»£ç å—æˆ–HTMLæ ‡ç­¾
            const hasHtmlCodeBlock = content.includes('```html') || content.includes('```HTML');
            const hasHtmlTags = content.includes('<') && content.includes('>');
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«å¸¸è§çš„HTMLå…ƒç´ 
            const htmlElements = ['<html', '<div', '<p>', '<span', '<h1', '<h2', '<h3', 
                                 '<button', '<input', '<form', '<style', '<script', 
                                 '<header', '<footer', '<nav', '<section', '<article'];
            
            const hasHtmlElements = htmlElements.some(tag => 
                content.toLowerCase().includes(tag.toLowerCase()));
            
            return (hasHtmlCodeBlock || hasHtmlTags) && hasHtmlElements;
        }

        function extractHtmlContent(content) {
            // æ–¹æ³•1: æå– ```html ä»£ç å—
            const htmlCodeBlockRegex = /```html\s*([\s\S]*?)\s*```/i;
            const htmlCodeMatch = content.match(htmlCodeBlockRegex);
            if (htmlCodeMatch) {
                return htmlCodeMatch[1].trim();
            }
            
            // æ–¹æ³•2: æå– ``` ä»£ç å—ï¼ˆå¯èƒ½ä¸æ ‡æ³¨htmlï¼‰
            const codeBlockRegex = /```\s*([\s\S]*?)\s*```/;
            const codeMatch = content.match(codeBlockRegex);
            if (codeMatch) {
                const codeContent = codeMatch[1].trim();
                // æ£€æŸ¥æ˜¯å¦æ˜¯HTMLå†…å®¹
                if (codeContent.includes('<') && codeContent.includes('>')) {
                    return codeContent;
                }
            }
            
            // æ–¹æ³•3: æå–ä»<!DOCTYPEæˆ–<htmlå¼€å§‹çš„å®Œæ•´HTML
            const htmlDocRegex = /(<!DOCTYPE[\s\S]*)/i;
            const htmlDocMatch = content.match(htmlDocRegex);
            if (htmlDocMatch) {
                return htmlDocMatch[1].trim();
            }
            
            // æ–¹æ³•4: æå–æœ€å¤§çš„HTMLæ ‡ç­¾å—
            const htmlTagRegex = /(<[^>]+>[\s\S]*?<\/[^>]+>)/;
            const htmlTagMatch = content.match(htmlTagRegex);
            if (htmlTagMatch) {
                // æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ ‡ç­¾åï¼Œå°è¯•æå–æ•´ä¸ªHTMLç»“æ„
                const startIndex = content.indexOf(htmlTagMatch[1]);
                const possibleHtml = content.substring(startIndex);
                
                // ç®€å•çš„HTMLç»“æ„æå–
                let htmlContent = '';
                let tagStack = [];
                let i = 0;
                
                while (i < possibleHtml.length) {
                    if (possibleHtml[i] === '<') {
                        const tagEnd = possibleHtml.indexOf('>', i);
                        if (tagEnd !== -1) {
                            const tag = possibleHtml.substring(i, tagEnd + 1);
                            htmlContent += tag;
                            
                            // ç®€å•çš„æ ‡ç­¾åŒ¹é…æ£€æŸ¥
                            if (tag.includes('</')) {
                                tagStack.pop();
                            } else if (!tag.includes('/>') && !tag.includes('<br') && !tag.includes('<hr')) {
                                tagStack.push(tag);
                            }
                            
                            i = tagEnd + 1;
                            
                            // å¦‚æœæ ‡ç­¾æ ˆä¸ºç©ºä¸”æˆ‘ä»¬å·²ç»æœ‰å†…å®¹ï¼Œè¯´æ˜HTMLç»“æ„å®Œæ•´
                            if (tagStack.length === 0 && htmlContent.length > 50) {
                                break;
                            }
                        } else {
                            htmlContent += possibleHtml[i];
                            i++;
                        }
                    } else {
                        htmlContent += possibleHtml[i];
                        i++;
                    }
                }
                
                if (htmlContent.trim()) {
                    return htmlContent.trim();
                }
            }
            
            // å¦‚æœéƒ½æ²¡æ‰¾åˆ°ï¼Œè¿”å›åŸå†…å®¹
            return content;
        }

        function showClaudeOutput(content, isDocumentRequest = false) {
            const claudeContainer = document.getElementById('claudeOutputContainer');
            const claudeContent = document.getElementById('claudeOutputContent');
            const claudeTitle = document.getElementById('claudeTaskTitle');
            
            // æå–HTMLå†…å®¹
            let htmlContent = extractHtmlContent(content);
            
            // å¦‚æœæ˜¯æ–‡æ¡£åˆ›å»ºè¯·æ±‚ä½†æ²¡æœ‰æå–åˆ°HTMLï¼Œå°è¯•ç›´æ¥ä½¿ç”¨å†…å®¹
            if (isDocumentRequest && !htmlContent.includes('<html')) {
                // å¦‚æœå†…å®¹åŒ…å«HTMLæ ‡ç­¾ä½†ä¸æ˜¯å®Œæ•´çš„HTMLæ–‡æ¡£ï¼ŒåŒ…è£…å®ƒ
                if (content.includes('<') && content.includes('>')) {
                    htmlContent = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated Document</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
    </style>
</head>
<body>
    ${content}
</body>
</html>`;
                }
            }
            
            // æ›´æ–°æ ‡é¢˜
            if (isDocumentRequest) {
                claudeTitle.textContent = 'Generated Document';
            } else {
                claudeTitle.textContent = 'Generated Web Content';
            }
            
            // æ˜¾ç¤ºå®¹å™¨
            claudeContainer.style.display = 'block';
            
            // åˆ›å»ºiframeæ¥æ˜¾ç¤ºHTMLå†…å®¹
            const iframe = document.createElement('iframe');
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.border = 'none';
            iframe.style.background = 'white';
            
            // æ¸…ç©ºä¹‹å‰çš„å†…å®¹å¹¶æ·»åŠ iframe
            claudeContent.innerHTML = '';
            claudeContent.appendChild(iframe);
            
            // å†™å…¥HTMLå†…å®¹åˆ°iframe
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            iframeDoc.open();
            iframeDoc.write(htmlContent);
            iframeDoc.close();
        }

        function hideClaudeOutput() {
            const claudeContainer = document.getElementById('claudeOutputContainer');
            claudeContainer.style.display = 'none';
        }

        // æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    console.log('âœ… åç«¯æœåŠ¡è¿æ¥æ­£å¸¸');
                    // æ›´æ–°èŠå¤©è¾“å…¥æ¡†å ä½ç¬¦
                    chatInput.placeholder = 'Ask Clippy Anything';
                    return true;
                }
            } catch (error) {
                console.log('âŒ åç«¯æœåŠ¡æœªè¿æ¥');
                // æ›´æ–°èŠå¤©è¾“å…¥æ¡†å ä½ç¬¦
                chatInput.placeholder = 'è¯·å…ˆå¯åŠ¨åç«¯æœåŠ¡ (python server.py)';
                return false;
            }
            return false;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            // æ£€æŸ¥æœåŠ¡çŠ¶æ€
            checkServerStatus();
        });

        // æ‹–æ‹½åŠŸèƒ½
        let isDragging = false;
        let currentElement = null;
        let offset = { x: 0, y: 0 };
        let selectedDocuments = new Set();
        let mouseDownPos = { x: 0, y: 0 };
        let mouseDownTarget = null;
        const DRAG_THRESHOLD = 5;

        // è°ƒæ•´å¤§å°ç›¸å…³å˜é‡
        let isResizing = false;
        let currentResizeTarget = null;
        let resizeDirection = null;
        let originalRect = {};
        let startPos = {};

        // ä¸ºæ–‡æ¡£å®¹å™¨æ·»åŠ æ‹–æ‹½åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const excelContainer = document.querySelector('.excel-container');
            const wordContainer = document.querySelector('.word-container');
            const claudeContainer = document.getElementById('claudeOutputContainer');

            // ä¸ºæ–‡æ¡£å®¹å™¨æ·»åŠ æ‹–æ‹½äº‹ä»¶
            [excelContainer, wordContainer, claudeContainer].forEach(element => {
                element.addEventListener('mousedown', handleMouseDown);
                
                // ä¸ºè°ƒæ•´å¤§å°æ‰‹æŸ„æ·»åŠ äº‹ä»¶
                const resizeHandles = element.querySelectorAll('.resize-handle');
                resizeHandles.forEach(handle => {
                    handle.addEventListener('mousedown', handleResizeStart);
                });
            });

            // ä¸ºå¤é€‰æ¡†æ·»åŠ é€‰æ‹©äº‹ä»¶
            const excelCheckbox = document.getElementById('excel-checkbox');
            const wordCheckbox = document.getElementById('word-checkbox');
            const claudeCheckbox = document.getElementById('claude-checkbox');

            excelCheckbox.addEventListener('change', function(e) {
                handleCheckboxChange(excelContainer, e.target.checked);
                e.stopPropagation();
            });

            wordCheckbox.addEventListener('change', function(e) {
                handleCheckboxChange(wordContainer, e.target.checked);
                e.stopPropagation();
            });

            claudeCheckbox.addEventListener('change', function(e) {
                handleCheckboxChange(claudeContainer, e.target.checked);
                e.stopPropagation();
            });

            // é˜²æ­¢å¤é€‰æ¡†åŒºåŸŸè§¦å‘æ‹–æ‹½
            document.querySelectorAll('.document-checkbox').forEach(checkbox => {
                checkbox.addEventListener('mousedown', function(e) {
                    e.stopPropagation();
                });
            });

            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
            document.addEventListener('keydown', handleKeyDown);
        });

        function handleCheckboxChange(container, isChecked) {
            if (isChecked) {
                selectDocument(container);
            } else {
                deselectDocument(container);
            }
        }

        function handleMouseDown(e) {
            // å¦‚æœç‚¹å‡»çš„æ˜¯å¤é€‰æ¡†åŒºåŸŸï¼Œä¸å¯åŠ¨æ‹–æ‹½
            if (e.target.closest('.document-checkbox')) {
                return;
            }

            // å¦‚æœç‚¹å‡»çš„æ˜¯æ»šåŠ¨æ¡åŒºåŸŸï¼Œä¸å¯åŠ¨æ‹–æ‹½
            if (e.target.scrollHeight > e.target.clientHeight && 
                e.offsetX > e.target.clientWidth - 20) {
                return;
            }

            const element = e.currentTarget;
            mouseDownTarget = element;
            mouseDownPos.x = e.clientX;
            mouseDownPos.y = e.clientY;
            
            const rect = element.getBoundingClientRect();
            offset.x = e.clientX - rect.left;
            offset.y = e.clientY - rect.top;

            e.preventDefault();
        }

        function handleMouseMove(e) {
            if (isResizing && currentResizeTarget) {
                performResize(e);
                return;
            }
            
            if (mouseDownTarget && !isDragging && !isResizing) {
                const deltaX = e.clientX - mouseDownPos.x;
                const deltaY = e.clientY - mouseDownPos.y;
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                
                if (distance > DRAG_THRESHOLD) {
                    startDrag(mouseDownTarget);
                }
            }
            
            if (isDragging && currentElement) {
                drag(e);
            }
        }

        function handleMouseUp(e) {
            if (isResizing) {
                stopResize();
            } else if (isDragging) {
                stopDrag();
            }
            mouseDownTarget = null;
            mouseDownPos.x = 0;
            mouseDownPos.y = 0;
        }

        function selectDocument(element) {
            element.classList.add('selected');
            selectedDocuments.add(element);
            
            // åŒæ­¥å¤é€‰æ¡†çŠ¶æ€
            const checkbox = element.querySelector('.checkbox-input');
            if (checkbox) {
                checkbox.checked = true;
            }
            
            updateSelectionInfo();
        }

        function deselectDocument(element) {
            element.classList.remove('selected');
            selectedDocuments.delete(element);
            
            // åŒæ­¥å¤é€‰æ¡†çŠ¶æ€
            const checkbox = element.querySelector('.checkbox-input');
            if (checkbox) {
                checkbox.checked = false;
            }
            
            updateSelectionInfo();
        }

        function toggleSelection(element) {
            if (selectedDocuments.has(element)) {
                deselectDocument(element);
            } else {
                selectDocument(element);
            }
        }

        function clearAllSelections() {
            selectedDocuments.forEach(element => {
                element.classList.remove('selected');
                // åŒæ­¥å¤é€‰æ¡†çŠ¶æ€
                const checkbox = element.querySelector('.checkbox-input');
                if (checkbox) {
                    checkbox.checked = false;
                }
            });
            selectedDocuments.clear();
            updateSelectionInfo();
        }

        function updateSelectionInfo() {
            console.log(`Selected documents: ${selectedDocuments.size}`);
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šçš„é€‰æ‹©çŠ¶æ€åé¦ˆ
        }

        function handleKeyDown(e) {
            // æŒ‰Escapeé”®å–æ¶ˆæ‰€æœ‰é€‰æ‹©
            if (e.key === 'Escape') {
                clearAllSelections();
            }
            // æŒ‰Ctrl+Aé€‰æ‹©æ‰€æœ‰æ–‡æ¡£
            if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
                e.preventDefault();
                const excelContainer = document.querySelector('.excel-container');
                const wordContainer = document.querySelector('.word-container');
                const claudeContainer = document.getElementById('claudeOutputContainer');
                
                selectDocument(excelContainer);
                selectDocument(wordContainer);
                
                // åªæœ‰å½“Claudeå®¹å™¨å¯è§æ—¶æ‰é€‰æ‹©å®ƒ
                if (claudeContainer && claudeContainer.style.display !== 'none') {
                    selectDocument(claudeContainer);
                }
            }
        }

        function startDrag(element) {
            isDragging = true;
            currentElement = element;
            element.classList.add('dragging');
        }

        function drag(e) {
            if (!isDragging || !currentElement) return;
            
            e.preventDefault();
            
            const x = e.clientX - offset.x;
            const y = e.clientY - offset.y;
            
            // é™åˆ¶åœ¨ç”»å¸ƒèŒƒå›´å†…
            const maxX = window.innerWidth - currentElement.offsetWidth;
            const maxY = window.innerHeight - currentElement.offsetHeight;
            
            const boundedX = Math.max(0, Math.min(x, maxX));
            const boundedY = Math.max(0, Math.min(y, maxY));
            
            currentElement.style.left = boundedX + 'px';
            currentElement.style.top = boundedY + 'px';
        }

        function stopDrag() {
            if (currentElement) {
                currentElement.classList.remove('dragging');
                currentElement = null;
            }
            isDragging = false;
        }

        // è°ƒæ•´å¤§å°ç›¸å…³å‡½æ•°
        function handleResizeStart(e) {
            e.preventDefault();
            e.stopPropagation();
            
            isResizing = true;
            currentResizeTarget = e.target.closest('.excel-container, .word-container, .claude-output-container');
            
            // ç¡®å®šè°ƒæ•´æ–¹å‘
            if (e.target.classList.contains('resize-handle-se')) {
                resizeDirection = 'se';
            } else if (e.target.classList.contains('resize-handle-e')) {
                resizeDirection = 'e';
            } else if (e.target.classList.contains('resize-handle-s')) {
                resizeDirection = 's';
            }
            
            // è®°å½•åˆå§‹ä½ç½®å’Œå°ºå¯¸
            const rect = currentResizeTarget.getBoundingClientRect();
            originalRect = {
                width: rect.width,
                height: rect.height,
                left: rect.left,
                top: rect.top
            };
            
            startPos = {
                x: e.clientX,
                y: e.clientY
            };
            
            // æ·»åŠ è°ƒæ•´å¤§å°çŠ¶æ€çš„æ ·å¼
            currentResizeTarget.style.userSelect = 'none';
            currentResizeTarget.classList.add('resizing'); // æ·»åŠ è°ƒæ•´å¤§å°çŠ¶æ€ç±»
            document.body.style.cursor = e.target.style.cursor;
            
            // ä¸´æ—¶ç§»é™¤CSSçš„é«˜åº¦é™åˆ¶ï¼Œå…è®¸è‡ªç”±è°ƒæ•´å¤§å°
            currentResizeTarget.style.maxHeight = 'none';
            currentResizeTarget.style.height = rect.height + 'px';
        }

        function performResize(e) {
            if (!isResizing || !currentResizeTarget) return;
            
            const deltaX = e.clientX - startPos.x;
            const deltaY = e.clientY - startPos.y;
            
            let newWidth = originalRect.width;
            let newHeight = originalRect.height;
            
            if (resizeDirection === 'se' || resizeDirection === 'e') {
                newWidth = Math.max(200, originalRect.width + deltaX);
            }
            
            if (resizeDirection === 'se' || resizeDirection === 's') {
                newHeight = Math.max(150, originalRect.height + deltaY);
            }
            
            // ç¡®ä¿ä¸è¶…å‡ºè§†çª—è¾¹ç•Œ
            const maxWidth = window.innerWidth - originalRect.left - 20;
            const maxHeight = window.innerHeight - originalRect.top - 20;
            
            newWidth = Math.min(newWidth, maxWidth);
            newHeight = Math.min(newHeight, maxHeight);
            
            currentResizeTarget.style.width = newWidth + 'px';
            currentResizeTarget.style.height = newHeight + 'px';
        }

        function stopResize() {
            if (currentResizeTarget) {
                currentResizeTarget.style.userSelect = '';
                currentResizeTarget.classList.remove('resizing'); // ç§»é™¤è°ƒæ•´å¤§å°çŠ¶æ€ç±»
                // ä¸æ¢å¤max-heighté™åˆ¶ï¼Œä¿æŒç”¨æˆ·è°ƒæ•´åçš„å¤§å°
                // è¿™æ ·ç”¨æˆ·å°±å¯ä»¥è‡ªç”±è°ƒæ•´å®¹å™¨å¤§å°è€Œä¸å—CSSé™åˆ¶
                currentResizeTarget = null;
            }
            
            document.body.style.cursor = '';
            isResizing = false;
            resizeDirection = null;
        }
    </script>
</body>
</html>
